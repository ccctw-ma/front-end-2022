var setupInfo,gameState="first-setup",states={firstSetup:"first-setup",secondSetup:"second-setup",thirdSetup:"third-setup",play:"play",end:"end"},turnCounter=1,tiles=new Array(25),player=null,playerTurn=!0,objectCounters={blockCounter:0,redCounter:0,blackCounter:0};class Tile{constructor(e){this.tileId=e,this.tileDiv=document.getElementById("c"+e),this.isOccupied=!1,this.isSelected=!1,this.isBlock=!1,this.isRed=!1,this.isBlack=!1,this.value=0}}Tile.selectedTile=null;var FirstSetupInstructions="<p> places an arbitrary number of blocks on the grid<br><br>To place a block select a cell and press 'b'",SecondSetupInstructions="<p>Please select at least one and at most eight red pieces<br><br>To place a red piece select a cell and press one of the numbers 1 to 4<br><br>There are at most 3 number 1, at most 2 number 2, at most 2 number 3, and at most 1  number 4<br><br>Don't try to change an object already on the grid</p>",ThirdSetupInstructions="<p>Please select at least one and at most eight black pieces<br><br>To place a black piece select a cell and press one of the numbers 1 to 4<br><br>There are at most 3 number 1, at most 2 number 2, at most 2 number 3, and at most 1  number 4<br><br>Don't try to change an object already on the grid</p>",playInstructions="<p>Please select one red pieces and move it<br><br>To move one cell up press 'w'<br><br>To move one cell to the left press 'a'<br><br>To move one cell down press 's'<br><br>To move one cell to the right press 'd'</p>";function printInstructions(e){e==states.firstSetup?document.getElementById("instructions").innerHTML=FirstSetupInstructions:e===states.secondSetup?document.getElementById("instructions").innerHTML=SecondSetupInstructions:e===states.thirdSetup?document.getElementById("instructions").innerHTML=ThirdSetupInstructions:e==states.play&&(document.getElementById("instructions").innerHTML=playInstructions)}function refreshRightPanelInfo(e){"first-setup"===e||"second-setup"===e||"third-setup"===e?setupInfo="<p>Blocks: "+objectCounters.blockCounter+"<br><br>Red: "+objectCounters.redCounter+"<br><br>Black: "+objectCounters.blackCounter+"</p>":e===states.play&&(setupInfo="<p>Turn: "+turnCounter+"<br><br> player: "+(playerTurn?"user":"computer")+"<br><br>Red: "+objectCounters.redCounter+"<br><br>Black: "+objectCounters.blackCounter+"</p>"),document.getElementById("info").innerHTML=setupInfo}function setButton(e){"first-setup"==e?document.getElementById("endButton").innerHTML="End First SetUp":"second-setup"==e?document.getElementById("endButton").innerHTML="End Second SetUp":"third-setup"==e?document.getElementById("endButton").innerHTML="Play":"play"==e?document.getElementById("endButton").innerHTML="End Game":(e="end",document.getElementById("endButton").innerHTML="Play Again")}function printGrid(){var e="";for(i=0;i<25;i++)e+="<div class='gridCell' id='"+("c"+i)+"'></div>",(i+1)%5==0&&(e+='<div style="clear:both;"></div>');document.getElementById("grid").innerHTML=e}function createTiles(){for(let e=0;e<25;e++){var t=new Tile(e);tiles[e]=t}}function gridAddEventListeners(){tiles.forEach(e=>{e.tileDiv.addEventListener("click",function(){tileClicked(e.tileId)})})}function tileClicked(e){if(gameState!==states.end)if(tile=tiles[e],null===Tile.selectedTile)(Tile.selectedTile=tile).isSelected=!0,tile.tileDiv.style.border="6px solid white";else if(Tile.selectedTile!=tile){Tile.selectedTile.isSelected=!1;const t=Tile.selectedTile;t.isRed?t.tileDiv.style.border="6px solid red":t.isBlack?t.tileDiv.style.border="6px solid black":t.isBlock?t.tileDiv.style.border="6px solid gray":t.tileDiv.style.border=null,(Tile.selectedTile=tile).isSelected=!0,tile.tileDiv.style.border="6px solid white"}else tile.isSelected&&(Tile.selectedTile=null,tile.isSelected=!1,tile.isRed?tile.tileDiv.style.border="6px solid red":tile.isBlack?tile.tileDiv.style.border="6px solid black":tile.isBlock?tile.tileDiv.style.border="6px solid gray":tile.tileDiv.style.border=null)}function checkRedPiecesNumber(e){const t=[0,0,0,0];let l=0;return tiles.forEach(e=>{e.isRed&&(t[e.value-1]++,l++)}),8===l?"There are at most 8 red pieces":"1"===e&&3===t[0]?"There are at most 3 red pieces with the number 1":"2"===e&&2===t[1]?"There are at most 2 red pieces with the number 2":"3"===e&&2===t[2]?"There are at most 2 red pieces with the number 3":"4"===e&&1===t[3]?"There are at most 1 red pieces with the number 4":""}function checkBlackPiecesNumber(e){const t=[0,0,0,0];let l=0;return tiles.forEach(e=>{e.isBlack&&(t[e.value-1]++,l++)}),8===l?"There are at most 8 black pieces":"1"===e&&3===t[0]?"There are at most 3 black pieces with the number 1":"2"===e&&2===t[1]?"There are at most 2 black pieces with the number 2":"3"===e&&2===t[2]?"There are at most 2 black pieces with the number 3":"4"===e&&1===t[3]?"There are at most 1 black pieces with the number 4":""}function handleKeyboardEvents(e){if(gameState===states.firstSetup)if("b"===e.key){if(null!==Tile.selectedTile&&!Tile.selectedTile.isOccupied)if(23<=objectCounters.blockCounter)printErrorMessage("There are at most 1 red piece and at most 1 blakc piece");else{const l=Tile.selectedTile.tileDiv;Tile.selectedTile.isOccupied=!0,Tile.selectedTile.isBlock=!0,l.style.border="6px solid gray",l.style.backgroundColor="gray",objectCounters.blockCounter+=1,refreshRightPanelInfo(gameState)}}else printErrorMessage('You pressed the wrong key. Please press "b"');else if(gameState===states.secondSetup)if("1"===e.key||"2"===e.key||"3"===e.key||"4"===e.key)if(clearErrorMessage(),null===Tile.selectedTile)printErrorMessage("Please select a cell");else if(Tile.selectedTile.isOccupied)printErrorMessage("Don't try to change an object already on the grid");else{var t=checkRedPiecesNumber(e.key);if(0===t.length){Tile.selectedTile.isRed=!0,Tile.selectedTile.isOccupied=!0,Tile.selectedTile.value=Number(e.key);const r=Tile.selectedTile.tileDiv;r.style.backgroundColor="red",r.style.border="6px solid red",r.innerText=e.key,objectCounters.redCounter+=1,refreshRightPanelInfo(gameState)}else printErrorMessage(t)}else printErrorMessage("You pressed the wrong key. Please press numbers 1 to 4");else if(gameState===states.thirdSetup)if("1"===e.key||"2"===e.key||"3"===e.key||"4"===e.key)if(clearErrorMessage(),null===Tile.selectedTile)printErrorMessage("Please select a cell");else if(Tile.selectedTile.isOccupied)printErrorMessage("Don't try to change an object already on the grid");else{t=checkBlackPiecesNumber(e.key);if(0===t.length){Tile.selectedTile.isBlack=!0,Tile.selectedTile.isOccupied=!0,Tile.selectedTile.value=Number(e.key);const s=Tile.selectedTile.tileDiv;s.style.backgroundColor="black",s.style.border="6px solid black",s.innerText=e.key,objectCounters.blackCounter+=1,refreshRightPanelInfo(gameState)}else printErrorMessage(t)}else printErrorMessage("You pressed the wrong key. Please press numbers 1 to 4");else gameState===states.play&&(clearErrorMessage(),"w"===e.key||"a"===e.key||"s"===e.key||"d"===e.key?null!==Tile.selectedTile&&Tile.selectedTile.isRed?playerTurn?redCanMove(Tile.selectedTile.tileId,e.key)?(playerMove(Tile.selectedTile.tileId,e.key),1===(t=checkGameStatus())?(printErrorMessage("User Win !!!"),setButton(gameState=states.end)):-1===t?(printErrorMessage("Computer Win !!!"),setButton(gameState=states.end)):(playerTurn=!1,refreshRightPanelInfo(gameState),setTimeout(()=>{computerMove()},750))):printErrorMessage("the selected red piece can't move"):printErrorMessage("computer's turn"):printErrorMessage("Please select a red cell"):printErrorMessage('You pressed the wrong key. Please press "w", "a", "s", "d"'))}function handleButtonClick(){if(gameState===states.firstSetup)setButton(states.secondSetup),printInstructions(states.secondSetup),gameState=states.secondSetup;else if(gameState===states.secondSetup){let t=0;tiles.forEach(e=>{e.isRed&&t++}),0===t?printErrorMessage("Please select at least one red pieces"):(setButton(states.thirdSetup),printInstructions(states.thirdSetup),clearErrorMessage(),gameState=states.thirdSetup)}else if(gameState===states.thirdSetup){let t=0;tiles.forEach(e=>{e.isBlack&&t++}),0===t?printErrorMessage("Please select at least one black pieces"):(setButton(states.play),printInstructions(states.play),clearErrorMessage(),refreshRightPanelInfo(gameState=states.play))}else{var e;gameState===states.play?(e=checkGameStatus(),console.log(e),1===e?printErrorMessage("User Win !!!"):0===e?printErrorMessage("Draw !!!"):-1===e&&printErrorMessage("Computer Win !!!"),gameState=states.end):console.log("end")}}function printErrorMessage(e){document.getElementById("error_messages").innerHTML=e}function clearErrorMessage(){document.getElementById("error_messages").innerHTML=""}function initSetup(){printInstructions(states.firstSetup),refreshRightPanelInfo(states.firstSetup),setButton(states.firstSetup)}function playerMove(e,t){var l=index2xy(e),r=l[0],l=l[1];let s,i;"w"===t?(s=r-1,i=l):"a"===t?(s=r,i=l-1):"s"===t?(s=r+1,i=l):"d"===t&&(s=r,i=l+1);t=xy2index(s,i);let n=tiles[e],a=tiles[t];a.isOccupied?n.value>a.value||1===n.value&&4==a.value?(Tile.selectedTile=null,a.isOccupied=!0,a.isSelected=!1,a.isRed=!0,a.isBlack=!1,a.value=n.value,a.tileDiv.innerText=a.value,a.tileDiv.style.backgroundColor="red",a.tileDiv.style.border="6px solid red",n.isOccupied=!1,n.isRed=!1,n.value=0,n.tileDiv.innerText=null,n.tileDiv.style.backgroundColor=null,n.tileDiv.style.border=null,--objectCounters.blackCounter):(Tile.selectedTile=null,a.isSelected=!1,n.isOccupied=!1,n.isRed=!1,n.value=0,n.tileDiv.innerText=null,n.tileDiv.style.backgroundColor=null,n.tileDiv.style.border=null,--objectCounters.redCounter):(Tile.selectedTile=null,a.isOccupied=!0,a.isSelected=!1,a.isRed=!0,a.value=n.value,a.tileDiv.innerText=a.value,a.tileDiv.style.backgroundColor="red",a.tileDiv.style.border="6px solid red",n.isOccupied=!1,n.isRed=!1,n.value=0,n.tileDiv.innerText=null,n.tileDiv.style.backgroundColor=null,n.tileDiv.style.border=null)}function computerMove(){let l=[],t=[];for(let e=0;e<25;e++){var r;tiles[e].isBlack&&(blackCanMove(e,"w")||blackCanMove(e,"a")||blackCanMove(e,"s")||blackCanMove(e,"d"))&&l.push(e),!tiles[e].isBlack||0!==(r=redNearBlack(e)).length&&t.push(...r)}let s,e;if(0!==t.length){var i=t[Math.floor(Math.random()*t.length)];s=i[0],e=i[1]}else{s=l[Math.floor(Math.random()*l.length)];var n=["w","a","s","d"];let t=[];for(let e=0;e<4;e++)blackCanMove(s,n[e])&&t.push(n[e]);e=t[Math.floor(Math.random()*t.length)]}var i=index2xy(s),a=i[0],i=i[1];let o,c;"w"===e?(o=a-1,c=i):"a"===e?(o=a,c=i-1):"s"===e?(o=a+1,c=i):"d"===e&&(o=a,c=i+1);a=xy2index(o,c);let d=tiles[s],u=tiles[a];u.isOccupied?d.value>u.value||1===d.value&&4==u.value?(Tile.selectedTile=null,u.isOccupied=!0,u.isSelected=!1,u.isBlack=!0,u.isRed=!1,u.value=d.value,u.tileDiv.innerText=u.value,u.tileDiv.style.backgroundColor="black",u.tileDiv.style.border="6px solid black",d.isOccupied=!1,d.isBlack=!1,d.value=0,d.tileDiv.innerText=null,d.tileDiv.style.backgroundColor=null,d.tileDiv.style.border=null,--objectCounters.redCounter):(Tile.selectedTile=null,u.isSelected=!0,d.isOccupied=!1,d.isBlack=!1,d.value=0,d.tileDiv.innerText=null,d.tileDiv.style.backgroundColor=null,d.tileDiv.style.border=null,--objectCounters.blackCounter):(Tile.selectedTile=null,u.isOccupied=!0,u.isSelected=!1,u.isBlack=!0,u.value=d.value,u.tileDiv.innerText=u.value,u.tileDiv.style.backgroundColor="black",u.tileDiv.style.border="6px solid black",d.isOccupied=!1,d.isBlack=!1,d.value=0,d.tileDiv.innerText=null,d.tileDiv.style.backgroundColor=null,d.tileDiv.style.border=null),playerTurn=!0,turnCounter++,refreshRightPanelInfo(gameState);i=checkGameStatus();1===i?(printErrorMessage("User Win !!!"),setButton(gameState=states.end)):-1===i&&(printErrorMessage("Computer Win !!!"),setButton(gameState=states.end))}function redCanMove(e,t){var e=index2xy(e),l=e[0],e=e[1];let r,s;if("w"===t?(r=l-1,s=e):"a"===t?(r=l,s=e-1):"s"===t?(r=l+1,s=e):"d"===t&&(r=l,s=e+1),0<=r&&r<5&&0<=s&&s<5){t=tiles[xy2index(r,s)];if(t.isBlack||!t.isOccupied)return!0}return!1}function blackCanMove(e,t){var e=index2xy(e),l=e[0],e=e[1];let r,s;if("w"===t?(r=l-1,s=e):"a"===t?(r=l,s=e-1):"s"===t?(r=l+1,s=e):"d"===t&&(r=l,s=e+1),0<=r&&r<5&&0<=s&&s<5){t=tiles[xy2index(r,s)];if(t.isRed||!t.isOccupied)return!0}return!1}function redNearBlack(t){let l=[];var e=index2xy(t),r=e[0],s=e[1];let i,n;var a=["w","a","s","d"];for(let e=0;e<4;e++){var o=a[e];"w"===o?(i=r-1,n=s):"a"===o?(i=r,n=s-1):"s"===o?(i=r+1,n=s):"d"===o&&(i=r,n=s+1),0<=i&&i<5&&0<=n&&n<5&&tiles[xy2index(i,n)].isRed&&l.push([t,o])}return l}function index2xy(e){return[Math.floor(e/5),e%5]}function xy2index(e,t){return 5*e+t}function checkGameStatus(){let e=0;if(0===objectCounters.redCounter)return-1;if(0===objectCounters.blackCounter)return 1;if(playerTurn){let t=!1;for(let e=0;e<25;e++)if(tiles[e].isRed){var l=redCanMove(e,"w")||redCanMove(e,"a")||redCanMove(e,"s")||redCanMove(e,"d");if(t=t||l)break}e=t?0:-1}else{let t=!1;for(let e=0;e<25;e++)if(tiles[e].isBlack){var r=blackCanMove(e,"w")||blackCanMove(e,"a")||blackCanMove(e,"s")||blackCanMove(e,"d");if(t=t||r)break}e=t?0:1}return e}function start(){printGrid(),createTiles(),gridAddEventListeners(),initSetup(),document.getElementById("endButton").addEventListener("click",handleButtonClick),document.addEventListener("keydown",handleKeyboardEvents)}window.onload=start();