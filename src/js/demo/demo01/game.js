var gameState="setup",turnCounter=1,tiles=new Array(100),player=null,objectCounters={asteroidsCounter:0,inactiveMinesCounter:0,activeMinesCounter:0,roboticSpaceshipsCounter:0,playerSpaceshipsCounter:0},playersTurn=!0,setupInstructions="<p>To place an asteroid select a cell and press 'a'<br><br>To place a mine select a cell and press 'm'<br><br>To place a robotic spaceship select a cell and press 'r'<br><br>To place a user's spaceship select a cell and press 'u'<br><br>To delete an object press 'delete'</p>",playInstructions="<p> To move one cell up press 'w'<br><br>To move one cell to the left press 'a'<br><br>To move one cell down press 's'<br><br>To move one cell to the right press 'd'</p>";function printInstructions(e){"setup"==e?document.getElementById("instructions").innerHTML=setupInstructions:"play"==e&&(document.getElementById("instructions").innerHTML=playInstructions)}function refreshRightPanelInfo(e){setupInfo="setup"==e?"<p>Asteroids: "+objectCounters.asteroidsCounter+"<br><br>Mines: "+objectCounters.inactiveMinesCounter+"<br><br>Robotic Spaceships: "+objectCounters.roboticSpaceshipsCounter+"</p>":(e="play","<p>Turn: "+turnCounter+"<br><br> Inactive Mines: "+objectCounters.inactiveMinesCounter+"<br><br>Robotic Spaceships: "+objectCounters.roboticSpaceshipsCounter+"</p>"),document.getElementById("info").innerHTML=setupInfo}function setButton(){"setup"==gameState?document.getElementById("endButton").innerHTML="End Setup":"play"==gameState?document.getElementById("endButton").innerHTML="End Game":(gameState="end",document.getElementById("endButton").innerHTML="Play Again")}function buttonClick(){"setup"==gameState?1!=objectCounters.playerSpaceshipsCounter?printNoPlayerErrorMessage():(clearErrorMessage(),gameState="play",play()):"play"==gameState?(gameState="end",goToYouStopped()):"end"==gameState&&location.reload()}function printGrid(){var e="";for(i=0;i<100;i++)e+="<div class='gridCell' id='"+("c"+i)+"'></div>",(i+1)%10==0&&(e+='<div style="clear:both;"></div>');document.getElementById("grid").innerHTML=e}class Tile{constructor(e){this.tileId=e,this.tileDiv=document.getElementById("c"+i),this.isOccupied=!1,this.isSelected=!1,this.objectOnTile=null,this.playerOnTile=null,this.isMined=!1,this.checked=!1}}Tile.selectedTile=null;class RoboticSpaceship{constructor(e){this.position=e,this.offsets=[-11,-10,-9,-1,1,9,10,11]}calculateLegalMoves(){var e=[];for(i=0;i<this.offsets.length;i++){var t=this.position+this.offsets[i];!isValidCoordinate(t)||tiles[t].objectOnTile instanceof Asteroid||tiles[t].objectOnTile instanceof RoboticSpaceship||isFirstColumnException(this.position)&&(-11==this.offsets[i]||-1==this.offsets[i]||9==this.offsets[i])||isTenthColumnException(this.position)&&(-9==this.offsets[i]||1==this.offsets[i]||11==this.offsets[i])||e.push(t)}return e}}class PlayerSpaceship{constructor(e){this.position=e,this.offsets=[-10,-1,1,10]}calculateLegalMoves(){var e=[];for(i=0;i<this.offsets.length;i++){var t=this.position+this.offsets[i];!isValidCoordinate(t)||tiles[t].objectOnTile instanceof Asteroid||tiles[t].objectOnTile instanceof RoboticSpaceship||isFirstColumnException(this.position)&&-1==this.offsets[i]||isTenthColumnException(this.position)&&1==this.offsets[i]||e.push(t)}return e}}class Asteroid{constructor(e){this.position=e}}class Mine{constructor(e){this.position=e,this.isActive=!1}}function isValidCoordinate(e){return 0<=e&&e<100}function isFirstColumnException(e){return e%10==0}function isTenthColumnException(e){return(e+1)%10==0}function createTiles(){for(i=0;i<100;i++)tile=new Tile(i),tiles[i]=tile}function gridAddEventListeners(){tiles.forEach(e=>{e.tileDiv.addEventListener("click",function(){tileClicked(e.tileId)})})}function tileClicked(e){tile=tiles[e],null==Tile.selectedTile?((Tile.selectedTile=tile).isSelected=!0,tile.tileDiv.style.border="3px solid white"):Tile.selectedTile!=tile?(Tile.selectedTile.isSelected=!1,Tile.selectedTile.tileDiv.style.border="3px solid #777777",(Tile.selectedTile=tile).isSelected=!0,tile.tileDiv.style.border="3px solid white"):tile.isSelected&&(Tile.selectedTile=null,tile.tileDiv.style.border="3px solid #777777")}function handleKeyboardEvents(e){"setup"==gameState&&null!=Tile.selectedTile&&(clearErrorMessage(),"a"==e.key?putObjectInCell("a"):"m"==e.key?putObjectInCell("m"):"r"==e.key?putObjectInCell("r"):"u"==e.key?putObjectInCell("u"):(46==e.keyCode?deleteObjectFromCell:printSetupWrongKeyErrorMessage)()),"play"==gameState&&playersTurn&&(clearErrorMessage(),"w"==e.key?playerMove("w"):"a"==e.key?playerMove("a"):"s"==e.key?playerMove("s"):"d"==e.key?playerMove("d"):printPlayWrongKeyErrorMessage())}function putObjectInCell(e){(tile=Tile.selectedTile).isOccupied&&deleteObjectFromCell(),"a"==e?(tile.tileDiv.innerText="A",objectCounters.asteroidsCounter++,tile.isOccupied=!0):"m"==e?(tile.tileDiv.innerText="M",objectCounters.inactiveMinesCounter++,tile.isOccupied=!0):"r"==e?(tile.tileDiv.innerText="R",objectCounters.roboticSpaceshipsCounter++,tile.isOccupied=!0):"u"==e&&0==objectCounters.playerSpaceshipsCounter&&(tile.tileDiv.innerText="U",objectCounters.playerSpaceshipsCounter++,tile.isOccupied=!0),refreshRightPanelInfo("setup")}function deleteObjectFromCell(){tile=Tile.selectedTile,"A"==(currentObject=tile.tileDiv.innerText)?(objectCounters.asteroidsCounter--,tile.tileDiv.innerText="",tile.isOccupied=!1):"M"==currentObject?(objectCounters.inactiveMinesCounter--,tile.tileDiv.innerText="",tile.isOccupied=!1):"R"==currentObject?(objectCounters.roboticSpaceshipsCounter--,tile.tileDiv.innerText="",tile.isOccupied=!1):"U"==currentObject&&(objectCounters.playerSpaceshipsCounter--,tile.tileDiv.innerText="",tile.isOccupied=!1),refreshRightPanelInfo("setup")}function printSetupWrongKeyErrorMessage(){document.getElementById("error_messages").innerHTML="You pressed the wrong key. Press a m r u or delete"}function printPlayWrongKeyErrorMessage(){document.getElementById("error_messages").innerHTML="You pressed the wrong key. Press w a s or d"}function printNoPlayerErrorMessage(){document.getElementById("error_messages").innerHTML="You must put the player's spaceship on the grid to play!"}function clearErrorMessage(){document.getElementById("error_messages").innerHTML=""}function checkNumbers(){0==objectCounters.roboticSpaceshipsCounter?goToYouWon():0==objectCounters.inactiveMinesCounter&&goToYouLost()}function goToYouWon(){gameState="end",document.getElementById("grid").innerHTML="YOU WON",setButton("end")}function goToYouLost(){gameState="end",document.getElementById("grid").innerHTML="YOU LOST",setButton("end")}function goToDraw(){gameState="end",document.getElementById("grid").innerHTML="DRAW",setButton("end")}function goToYouStopped(){document.getElementById("grid").innerHTML="YOU STOPPED THE GAME",setButton("end")}function createObjects(){for(let e=0;e<100;e++)tile=tiles[e],""!=(content=tile.tileDiv.innerText)&&("A"==content?tile.objectOnTile=new Asteroid(e):"M"==content?tile.objectOnTile=new Mine(e):"R"==content?tile.objectOnTile=new RoboticSpaceship(e):"U"==content&&(tile.playerOnTile=new PlayerSpaceship(e),player=tile.playerOnTile))}function play(){preparePlay()}function preparePlay(){printInstructions("play"),refreshRightPanelInfo("play"),checkNumbers(),setButton(),createObjects()}function computerMove(){for(let e=0;e<100;e++)if(tiles[e].objectOnTile instanceof RoboticSpaceship&&!tiles[e].checked)if(roboticSpaceship=tiles[e].objectOnTile,legalMoves=roboticSpaceship.calculateLegalMoves(),console.log(legalMoves),legalMoves.includes(player.position))console.log("yes"),changeComputerPosition(roboticSpaceship.position,player.position),tiles[player.position].checked=!0;else{moveMade=!1;for(let e=0;e<legalMoves.length;e++)tiles[legalMoves[e]].objectOnTile instanceof Mine&&!tiles[legalMoves[e]].objectOnTile.isActive&&!moveMade&&(changeComputerPosition(roboticSpaceship.position,legalMoves[e]),moveMade=!0,tiles[legalMoves[e]].checked=!0);moveMade||(move=legalMoves[Math.floor(Math.random()*legalMoves.length)],changeComputerPosition(roboticSpaceship.position,move),tiles[move].checked=!0)}for(let e=0;e<100;e++)tiles[e].checked=!1}function changeComputerPosition(e,t){tile=tiles[e],roboticSpaceship=tile.objectOnTile,null!=(newTile=tiles[t]).playerOnTile?(newTile.playerOnTile=null,newTile.objectOnTile=roboticSpaceship,tile.objectOnTile=null,roboticSpaceship.postion=t,tile.tileDiv.innerText="",newTile.tileDiv.innerText="R",newTile.isMined?(destroyRoboticSpaceship(roboticSpaceship),(0<objectCounters.roboticSpaceshipsCounter?goToYouLost:goToDraw)()):goToYouLost()):(newTile.objectOnTile instanceof Mine&&(objectCounters.inactiveMinesCounter--,checkNumbers()),newTile.objectOnTile=roboticSpaceship,tile.objectOnTile=null,roboticSpaceship.position=t,tile.tileDiv.innerText="",newTile.tileDiv.innerText="R",newTile.isMined&&(destroyRoboticSpaceship(roboticSpaceship),objectCounters.roboticSpaceshipsCounter<=0&&goToYouWon()))}function destroyRoboticSpaceship(e){tiles[e.position].tileDiv.innerText="",tiles[e.position].isOccupied=!1,tiles[e.position].objectOnTile=null,objectCounters.roboticSpaceshipsCounter--,refreshRightPanelInfo("play")}function playerMove(e){legalMoves=player.calculateLegalMoves(),"w"==e&&legalMoves.includes(player.position-10)?(changePlayersPosition(player.position,player.position-10),playersTurn=!1,setTimeout(function(){playTurns()},750)):"a"==e&&legalMoves.includes(player.position-1)?(changePlayersPosition(player.position,player.position-1),playersTurn=!1,setTimeout(function(){playTurns()},750)):"s"==e&&legalMoves.includes(player.position+10)?(changePlayersPosition(player.position,player.position+10),playersTurn=!1,setTimeout(function(){playTurns()},750)):"d"==e&&legalMoves.includes(player.position+1)&&(changePlayersPosition(player.position,player.position+1),playersTurn=!1,setTimeout(function(){playTurns()},750))}function changePlayersPosition(e,t){tile=tiles[e],((newTile=tiles[t]).playerOnTile=player).position=t,null==tile.objectOnTile?(tile.isOccupied=!1,tile.tileDiv.innerText=""):tile.objectOnTile instanceof Mine&&(tile.tileDiv.innerText="M"),newTile.objectOnTile instanceof Mine&&(console.log("stepped on mine"),console.log(newTile.objectOnTile),activateMine(newTile.objectOnTile)),newTile.tileDiv.innerText="U",tile.playerOnTile=null}function activateMine(t){tiles[t.position].isMined=!0,tiles[t.position].tileDiv.style="border: 3px solid red",surroundings=[-11,-10,-9,-1,1,9,10,11];for(let e=0;e<surroundings.length;e++)offset=surroundings[e],!isValidCoordinate(t.position+offset)||isFirstColumnException(t.position)&&(-11==surroundings[e]||-1==surroundings[e]||9==surroundings[e])||isTenthColumnException(t.position+offset)&&(-9==surroundings[e]||1==surroundings[e]||11==surroundings[e])||(tiles[t.position+offset].isMined=!0,tiles[t.position+offset].tileDiv.style="border: 3px solid red");t.isActive||(t.isActive=!0,objectCounters.inactiveMinesCounter--,refreshRightPanelInfo("play"))}function checkIfGameOver(){0==objectCounters.inactiveMinesCounter&&goToYouWon(),0==objectCounters.roboticSpaceshipsCounter&&goToYouLost()}function playTurns(){playersTurn||(computerMove(),turnCounter++,playersTurn=!0),refreshRightPanelInfo("play"),checkIfGameOver()}function start(){printInstructions("setup"),printGrid(),refreshRightPanelInfo("setup"),setButton(),createTiles(),document.addEventListener("keydown",function(e){handleKeyboardEvents(e)}),gridAddEventListeners()}window.onload=start();
